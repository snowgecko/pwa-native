<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width minimum-scale=1.0 maximum-scale=1.0 user-scalable=no" />
		<title>Content Pages</title>
		<link rel="shortcut icon" type="image/jpg" href="./favicon.ico"/>
		<link rel="manifest" href="./manifest.json">
	  	<link rel="apple-touch-icon" href="./assets/icons/icon-192x192.png"/>
		<link rel="apple-touch-icon" sizes="152x152" href="./images/icons/icon-152x152.png"/>
		<link rel="apple-touch-icon" sizes="167x167" href="./images/icons/icon-152x152.png"/>
		<link rel="apple-touch-icon" sizes="180x180" href="./images/icons/icon-192x192.png"/>
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.css">	

		<link type="text/css" rel="stylesheet" href="./css/style.css" />
		<link type="text/css" rel="stylesheet" href="./css/pages.css" />
		<link type="text/css" rel="stylesheet" href="./css/menu.css" />		
  		<link rel="stylesheet" type="text/css" href="./css/loader.css"/>
<!--just for the home page-->
		<link rel="stylesheet" href="./css/home.css">

		<!--class declaration--> 
  		<script src="./js/cPage.js" ></script>
  		<script src="./js/cMenu.js" ></script>
		<script type="text/javascript" src="./simpleIDB/SimpleIDB.js"></script>
		<!--DOES NOT WORK FOR SUB_SUB NAVIGATION ?ARIA issue-->
		<script src="./js/dl_1.js"></script>	<!--refactoring-->	
		<script src="./js/prl_1.js"></script>	<!--refactoring-->	
		<!--include module for editor--> 
<style>

</style>
<script>
window.addEventListener('load', ()=>{
   // console.log("in window load");	
	if ("serviceWorker" in navigator) {
	    try {
      		navigator.serviceWorker.register('./serviceWorker.js');
      		//console.log("Service Worker Registered");
    	} catch (error) {
      		//console.log("Service Worker Registration Failed");
		}
    }else{
	    //console.log("Service Worker not supported?");
	}
});
</script>
</head>
	<body>
	    <header> 
	      <h1><image src="./favicon.ico" alt="picture of stack of papers"/> STACK</h1>
	    </header>
		<div id="page">
			<div class="header" id="header">
				<div class="floatright" id="offline">online</div>
				<label class="switch">
					<input type="checkbox" id="ckslider">
					<span class="slider round" id="slider"></span>
				</label>
				<div class="floatright" id="settingsMenu">
					<ul>
						<li>&nbsp;<i class="fas fa-cog"></i>
							<ul>
								<li><a id="updateContent">update content</a></li>
								<li><a>settings 2</a></li>
							</ul>
						</li> 
						<!--<li class="twitter">twitter</li> -->
					</ul>
				</div>
					<!--<ul>
						<li><span>Navigation</span></li>
						<li><a class="active">Dashboard</a></li>
						<li class="inactive"><a>Statistics</a></li>
					</ul>-->
					<!--<div class="floatright borderwhite" id="update">Update Content</div>-->
				<div class="text">
					<a href="#menu" class="menulines"><span></span></a>
					<div id="section_title">.....</div>
				</div>
				<!--//-->
				<div id="mySidenav" class="sidenav">
					<input type="search" name="searchbox" id="searchbox" onKeyUp="edValueKeyPress()"/>
					<div id="menu">
				      <!--<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>-->
				      	<ul id="root"> 
							<!--onclick="javascript:toggleMenu(1)"-->
							<div id="html_menu">
								<!--*****WILL BE POPULATED DYNAMICALLY JS******-->
							</div>
							<li><a href="#">About</a></li>
				      		<li><a href="#">Contact</a></li>
							<li><a href="#" id="logout">logout (exit)</a></li>
						</ul>
					</div>
				</div>
			    <div class="ca_loaders" id="ca_loaders">
			      <div class="ca_loader" id="ca_loader">
			        <div class="loader-inner ball-grid-pulse">
			          <div></div>
			          <div></div>
			          <div></div>
			          <div></div>
			          <div></div>
			          <div></div>
			          <div></div>
			          <div></div>
			          <div></div>
			        </div>
			      </div>
				<p>&nbsp;&nbsp;&nbsp;loading content....</p>
				</div>
			</div>
			<!-- change header depending on section-->
			<div class="headerimage" id="headerimage"></div>
			<div id="content_main" class="content main">
				<h3 id="pagetitle"><!--does not appear after load--></h3>
				<!--content once the indexedDB is loaded-->
				<div id="content_variable">
					<div id="homepagepads" class="pads">
						<div class="pad-top">
							<div class="pad1"><a href="index.html?id=1">FRCA Primary</a></div>
							<div class="pad2"><a href="index.html?id=2">FRCA Final</a></div>
							<div class="pad3"><a href="index.html?id=4">FICM</a></div>
						</div>
						<div class="pad-bottom">
							<div class="pad4"><a href="index.html?id=">Pain</a></div>
							<div class="pad5"><a href="index.html?id=58">....</a></div>
							<div class="pad6"><a href="index.html?id=4">Thames valley CCC</a></div>
						</div>
					</div>
					<div id="page_content">
						<div class="element"></div>
						<div id="questions"></div>					
					</div>
					<div id="message"></div>
					<!--used on content pages-->
				</div>
			</div>
			<!-- /////-->
			<div id="login_main">			
				<!--LOGIN START used on login page-->
					<form method="post" id="loginForm">
						<h3>Login</h3>
		          		<label for="username">Email &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
		          		<input type="text" id="username" name="username" required><br/>
		          		<label for="password">Password&nbsp;&nbsp;</label>
		          		<input type="text" id="password" name="password" required><br/>&nbsp;<br/>
	          			<button type="submit" id="submitBtn">Login</button>
					</form>
					<p id="passwordmessage"></p>
					<!--//-->
			</div>
		</div>
<script>
	//*****global variables set in functions_shared.js
	var cidb = new SimpleIDB();
	var bIsLoggedIn = new Boolean(false);
	var gMenuDataSource = getIDBMenuData;
	var gPageDataSource = getIDBPageData;
	var listElem; 
	var bEditMode = false;
	var username = "";
	var password = "";
	var userInfo; 

	const homepageNode = document.getElementById("homepagepads");
	const loginNode = document.getElementById("loginForm");
	const contentVar_div = document.getElementById("content_variable");
	const pagecontent_div = document.getElementById("page_content");
	const message_div = document.getElementById("message");

	const para_loader = document.getElementById("para_loader");
	const ca_loaders = document.getElementById("ca_loaders");

	const contentItems = document.querySelectorAll(".content");

	url_dev = urlParams.get('dev');
	var _ckslider = document.getElementById("ckslider");
	var _cksliderText = document.getElementById("offline");
	console.log("_ckslider.checked" + _ckslider.checked)
	
	if ((url_dev == "true") || !(_ckslider.checked)){
		gMenuDataSource = getRemoteMenuData;
		gPageDataSource = getRemotePageData;
		console.log("getRemoteData");
	}	
	
	window.onload = function() {
				
		verifyUserContent(cidb, gMenuDataSource);
		//set defaults 
		homepageNode.style.display = "none";
		pagecontent_div.style.display = "none";		
		loginNode.style.display = "block";
		
		contentItems.forEach(function(cItems) {
			addEvent(cItems);
		});				
		document.querySelector( 'a[href="#menu"]' )
			.addEventListener( 'click', e => {
				e.preventDefault();
				changeNavState(); //called from functions_shared.js - simply changes classes
		});
		
		document.body.addEventListener("click", function(e) {
			//*** need the slider to slide so DO NOT PREVENT default.... DO NOT duplicate so e.target.id = slider
			if ((e.target.id !== "slider") && (e.target.id !== "ckslider")) e.preventDefault();
			console.log ("e.target.id", e.target.id);
			if(e.target.id == "ckslider"){
				//console.log ("_ckslider.checked", _ckslider.checked);
				if (_ckslider.checked){
					//console.log('get online content');
					gMenuDataSource = getIDBMenuData;
					gPageDataSource = getIDBPageData;
					//console.log("getRemoteData");
					_cksliderText.innerHTML = "offline";
				}else{
					//console.log('get offline content');
					gMenuDataSource = getRemoteMenuData;
					gPageDataSource = getRemotePageData;
					_cksliderText.innerHTML = "online";
				}
			} 
			//from Login
			if(e.target.id == "submitBtn"){
				username = document.getElementById("username").value;
				password = document.getElementById("password").value;
				///************************VERIFYLOGIN - needs to be called from LoginForm AND onload**************
				const output = verifyLogin(cidb, gMenuDataSource, username, password); //displays homepage if logged in success
			}else if(e.target && e.target.id == "logout") {
				UserLoggedOut();
				changeNavState();
			}else if(e.target.id == "updateContent"){
				if (username == ""){
					UserLoggedOut();					
					changeNavState();
				} else{
					console.log("username=" + username + " password=" + password);
					handleUpdateContent(username, password)
				}
				//couuld call the serviceWorker.js - what advantage?
				//async function requestBackgroundSync() {
 			   	//	const registration = await navigator.serviceWorker.ready;
    			//	await registration.sync.register('updateData');
				//}
			}else if(e.target && e.target.nodeName == "A") {
				//change just for modules... change just for mdules
				//from navigation
				var loc_href = e.target.href 
				var equalsLoc = loc_href.indexOf("?id=") + 4; //? + 3
				var eTargetID = loc_href.substring(equalsLoc, loc_href.length);
				history.pushState('data to be passed', 'Page Title', e.target.href );
				if(e.target.parentNode.className.indexOf("pad")!=-1){
					const menuData = gMenuDataSource(cidb, eTargetID, eTargetID); //var x = await **calls different function based on edit or NOT edit */ 							
				}
				if (loc_href.indexOf("#menu") == -1){
					resolveLink_ExpandMenu_printPage(e);	
				} 
			}else{
				//console.log ("on click with no event listener attached");
			}
		});
		
		/*******event listeners*****/
				//console.log("e.target.parent=" + e.target.parentNode.className);
				//console.log("e.target.href=" + e.target.href);
		//document.body.addEventListener
		//document.getElementById("searchbox").addEventListener("keypress", edValueKeyPress);
		
	};	

</script>

</body>
</html>
