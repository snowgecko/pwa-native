(function(e,t,n,r){"use strict";function i(t){function L(){N=(new nt).pause();C.push(N);if(n)T.on("versionchange",function(t){if(t.newVersion&&t.newVersion>v){T.close();e.location.reload(true)}})}function A(e,t){Object.keys(t).forEach(function(n){e[n]=t[n]})}function O(e){return{from:function(t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;return{extend:function(t){A(e.prototype,t)}}}}}function M(e){this._cfg={version:e,tableSchema:null,schemaUpgrade:null,contentUpgrade:null}}function _(e,t,n){if(e==0){Object.keys(d).forEach(function(e){H(t,e,d[e].primKey,d[e].indexes)});var r=new rt(t);var i=new U(r,g);r.dexieTrans=i;i.on("error",function(e){n("Failed to populate database: "+e)});T.on("populate").fire(i)}else{var s=[];d=null;var o=m.filter(function(t){return t._cfg.version>e});o.forEach(function(e){var r=d;var i=e._cfg.tableSchema;d=i;if(!r){s.push(function(e,t){Object.keys(i).forEach(function(t){H(e,t,i[t].primKey,i[t].indexes)});t()})}else{var o=D(r,i);o.add.forEach(function(e){s.push(function(t,n){H(t,e[0],e[1].primKey,e[1].indexes)});cb()});o.change.forEach(function(e){if(e.recreate){if(dt()){if(!x||!x[e.name]){x=x||{__num:0};++x.__num;x[e.name]=[];Y(t.objectStore(e.name).openCursor(),null,function(t){x[e.name].push(t)},function(){if(--x.__num==0){t.abort();T.open()}})}}s.push(function(t,n){j(t,e.name,e.def.primKey,e.def.indexes,n)})}else{s.push(function(t,n){var r=t.objectStore(e.name);e.add.forEach(function(e){B(r,e)});e.change.forEach(function(e){r.deleteIndex(e.name);B(r,e)});e.del.forEach(function(e){r.deleteIndex(e)});n()})}});if(i._cfg.contentUpgrade){s.push(function(t,r){var s=new it(t);var o=new U(t,s,t.db.objectStoreNames);s.dexieTrans=o;s.onfinish=r;o.on("error",function(t){n("Failed running upgrader function for version "+e._cfg.version+": "+t)});i._cfg.contentUpgrade(o);if(s.uncompleteRequests==0)r()})}if(o.del.length){if(!dt()){s.push(function(e,t){o.del.forEach(function(t){e.db.deleteObjectStore(t)});t()})}}}});var u=function(){if(s.length)s.shift()(t,u)};if(x&&x.__num>0)return;u()}}function D(e,t){var n={del:[],add:[],change:[]};for(var r in e){if(!t[r])n.del.push(r)}for(var r in t){var i=e[r],s=t[r];if(!i)n.add.push([r,s]);else{var o={name:r,def:t[r],recreate:false,del:[],add:[],change:[]};if(i.primKey.src!=s.primKey.src){o.recreate=true;n.change.push(o)}else{var u=i.indexes.reduce(function(e,t){e[t.name]=t;return e},{});var a=s.indexes.reduce(function(e,t){e[t.name]=t;return e},{});for(var f in u){if(!a[f])o.del.push(f)}for(var f in a){var l=u[f],c=a[f];if(!l)o.add.push(c);else if(l.src!=c.src)o.change.push(c)}if(o.recreate||o.del.length>0||o.add.length>0||o.change.length>0){n.change.push(o)}}}}return n}function P(e,t,n){Y(e.openCursor(),null,function(e){t.add(e)},n)}function H(e,t,n,r){var i=e.db.createObjectStore(t,{keyPath:n.keyPath,autoIncrement:n.auto});r.forEach(function(e){B(i,e)});return i}function B(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function j(e,t,n,r,i){if(x){var s=H(e,t,n,r);x[t].forEach(function(e){s.add(e)});delete x[t];if(Object.keys(x).length==0)x=null;i()}else{var o=H(e,"_temp-"+t,n,[]);P(e.objectStore(t),o,function(){e.db.deleteObjectStore(t);var s=H(e,t,n,r);P(o,s,function(){e.db.deleteObjectStore("_temp-"+t);i()})})}}function F(e,t,n){this._name=e;this._tf=t;this._collClass=n||W}function I(e,t){F.call(this,e,t,X)}function q(e,t){I.call(this,e,t)}function R(e,t,n){this._ctx={tf:e,storeNames:t,tableClass:n||F};this.on=pt(this,["complete","error"],"abort");this.complete=function(e){return this.on("complete",e)};this.error=function(e){return this.on("error",e)};e.dexieTrans=this;J(this,e,n||F,t)}function U(e,t){R.call(this,e,t,I)}function z(e,t,n,r,i){this._ctx={tf:e,table:t,index:n,collClass:r||W,or:i}}function W(e,t){var n=e._ctx;this._ctx={tf:n.tf,table:n.table,index:n.index,range:t,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,offset:0,limit:Infinity,trans:null,oneshot:n.tf.oneshot,error:null,or:n.or}}function X(){W.apply(this,arguments)}function V(e,t){return e._cfg.version-t._cfg.version}function $(){return m.sort(V).reduce(function(e,t){return t._cfg.tableSchema?t:e})._cfg.tableSchema}function J(e,t,n,r,i){for(var s=0,o=r.length;s<o;++s){var u=r[s];if(!e[u]){e[u]=new n(u,t);if(i)e[u]._instanceTemplate=i[u].instanceTemplate}}}function K(e){for(var t in e){if(e[t]instanceof F)delete e[t]}}function Q(e){var t=setTimeout(e,1e3);clearTimeout(t)}function G(e){return T[e]._instanceTemplate}function Y(e,t,n,r,i,s){if(!e.onerror)e.onerror=ht(i,["calling openCursor() or openKeyCursor() on",self._name]);if(s){var o=n;if(k){n=function(e,t,n){if(e)e.__proto__=s;o(e,t,n)}}else{n=function(e,t,n){if(e){var r=Object.create(s);for(var i in e)r[i]=e[i];o(r,t)}else o(e,t,n)}}}if(t){e.onsuccess=ut(function(s){var o=s.target.result;if(o){var u=function(){o.continue()};if(t(o,function(e){u=e},r,i))n(o.value,o,function(e){u=e});u()}else{r()}},i)}else{e.onsuccess=ut(function(t){var i=t.target.result;if(i){var s=function(){i.continue()};n(i.value,i,function(e){s=e});s()}else{r()}},i)}}function Z(e){var t=[];e.split(",").forEach(function(e){if(!e)return;var n=e.replace("&","").replace("++","").replace("*","");var r=n.indexOf("[")!==0?n:e.substring(1,e.indexOf("]")).split("+");var i={name:n,keyPath:r||null,unique:e.indexOf("&")!=-1,multi:e.indexOf("*")!=-1,auto:e.indexOf("++")!=-1,compound:Array.isArray(r),dotted:r.indexOf(".")!=-1};i.src=(i.unique?"&":"")+(i.multi?"*":"")+(i.auto?"++":"")+i.keyPath;t.push(i)});return t}function et(e,t){return e<t?-1:e>t?1:0}function tt(e,t){return e<t?1:e>t?-1:0}function nt(){this.waitingFns=[];this.paused=false}function rt(e,t){nt.call(this);this.dexieTrans=null;this.trans=e instanceof f?e:null;this.storeNames=this.trans?null:e;this.mode=t||null;this.inactive=false}function it(e,t){rt.call(this,e,t);this.uncompleteRequests=0;this.onfinish=null}function st(e){if(!e)throw new p("Assertion failed")}function ot(t){if(e.setImmediate)setImmediate(t);else setTimeout(t,0)}function ut(e,t){return function(){try{e.apply(this,arguments)}catch(n){t(n)}}}function at(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function ft(e){return function(t){return e(t&&t.target&&t.target.error)}}function lt(e,t){if(!t)return e;if(Array.isArray(t)){var n=[];for(var i=0,s=t.length;i<s;++i){var o=lt(e,t[i]);if(o===r)return;n.push(o)}return o}var u=t.indexOf(".");if(u!=-1){var a=e[t.substr(0,u)];return a===r?r:lt(a,t.substr(u+1))}return e[t]}function ct(e,t,n){if(!e||t===r)return;if(Array.isArray(t)){st(Array.isArray(n));for(var i=0,s=t.length;i<s;++i){ct(e,t[i],n[i])}}else{var o=t.indexOf(".");if(o!==-1){var u=t.substr(0,o);var a=t.substr(o+1);if(a==="")e[u]=n;else{var f=e[u];if(!f)f=e[u]={};ct(f,a,n)}}else{e[t]=n}}}function ht(e,t){return function(n){var r=n&&n.target.error||{};var i=Object.create(r);i.toString=function(){return r.toString()+" occurred when "+t.map(function(e){return typeof e==="function"?e():JSON.stringify(e)}).join(" ")};var s=e(i);if(s){n.stopPropagation();n.preventDefault();return false}}}function pt(e,t){function i(e){function t(e){for(var t=this.l.length-1;t>=0;--t){if(this.l[t](e)===false)return false}}r[e]={l:[],f:t,s:function(e){this.l.push(e)},u:function(e){this.l=this.l.filter(function(t){return t!==e})}};return t}function o(e,t){var n=i(e);var o=i(t);var u=new s(function(n,i){r[e].f=n;r[t].f=i});r[e].p=u;u.then(function(t){n.call(r[e],t)},function(e){o.call(r[t],e)})}var n=arguments;var r={};for(var u=1,a=n.length;u<a;++u){var f=n[u];if(typeof f=="string"){i(f)}else{o(f[0],f[1])}}var l=function(t,n){if(n){r[t].s(n);return e}else if(typeof t==="string"){return{fire:function(e){r[t].f(e)},unsubscribe:function(e){r[t].u(e)}}}else{var i=t[0],s=t[1];return{getPromise:function(){return r[i].p}}}};return l}function dt(){return navigator.userAgent.indexOf("Trident / 7.0; rv: 11.0")>=0||navigator.userAgent.indexOf("MSIE")>=0}var o=i.dependencies;var u=o.indexedDB,a=o.IDBKeyRange,f=o.IDBTransaction;var l=o.DOMError,c=o.TypeError,h=o.RangeError,p=o.Error;var d=null;var v=0;var m=[];var g=[];var y=null;var b=null;var w=false;var E="readonly",S="readwrite";var x;var T=this;var N;var C=[];var k=function(){function e(){}var t=new e;try{t.__proto__=Object.prototype;return!(t instanceof e)}catch(n){return false}}();this.version=function(e){if(y)throw new p("Cannot add version when database is open");v=Math.max(v,e);var t=new M(e);m.push(t);return t};A(M.prototype,{stores:function(e){var t=this._cfg.tableSchema=this._cfg.tableSchema||{};Object.keys(e).forEach(function(n){var r={};var i=Z(e[n]);var s=i.shift();if(s.multi)throw new p("Primary key cannot be multi-valued");if(s.keyPath&&s.auto)ct(r,s.keyPath,0);i.forEach(function(e){if(e.auto)throw new p("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new p("Index must have a name and cannot be an empty string");ct(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")});t[n]={primKey:s,indexes:i,instanceTemplate:r}});var n=$();if(d!=n){d=n;K(T);J(T,N,q,Object.keys(n),n)}g=Object.keys(n);return this},upgrade:function(e){var t=this;Q(function(){e(new U(new nt,Object.keys(t._cfg.tableSchema)))});this._cfg.contentUpgrade=e;return this}});this.open=function(){return new s(function(e,n){function r(e){w=false;b=e;n(b);C.forEach(function(e){e.resume()})}if(y)throw new p("Database already open");try{b=null;w=true;if(m.length==0)throw new p("No versions specified. Need to call version(ver) method");if(!m[0]._cfg.tableSchema)throw new p("No schema specified. Need to call dbInstance.version(ver).stores(schema) on at least the lowest version.");m.sort(V).reduce(function(e,t){if(!t._cfg.tableSchema)t._cfg.tableSchema=e._cfg.tableSchema;return t});if(!u)throw new p("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");var i=u.open(t,v*10);i.onerror=ft(r);i.onblocked=T.on("blocked").fire;i.onupgradeneeded=function(e){i.transaction.onerror=ft(n);_(e.oldVersion/10,i.transaction,n)};i.onsuccess=function(e){w=false;y=i.result;y.onversionchange=T.on("versionchange").fire;C.forEach(function(e){e.resume()});C=[]}}catch(s){r(s)}})};this._backendDB=function(){return y};this.close=function(){if(y){y.close();C.push(N.pause());y=null;b=null}};this.delete=function(){return new s(function(e,n){function r(){T.close();var r=u.deleteDatabase(t);r.onsuccess=e;r.onerror=n;r.onblocked=T.on("blocked").fire}if(w){C.push({resume:r})}else{r()}})};this.on=pt(this,"error","ready","populate","blocked","versionchange");Q(function(){T.on("populate").fire(new U(new nt,g));T.on("error").fire(new p)});this.transaction=function(e,t,n){t=[].slice.call(arguments,1,arguments.length-1);n=arguments[arguments.length-1];return new s(function(r,i){var s=Array.isArray(t[0])?t.reduce(function(e,t){return e.concat(t)}):t;var o=s.map(function(e){if(typeof e=="string"){if(!d[e]){throw new p("Invalid table name: "+e);return{INVALID_TABLE_NAME:1}}return e}else{if(!(e instanceof F)){throw new c("Invalid type. Arguments following mode must be instances of Table or String");return{IVALID_TYPE:1}}return e._name}});var u,a;if(e==E||e=="r"){u=new rt(o,E);a=new R(u,o)}else if(e==S||e=="rw"){u=new rt(o,S);a=new U(u,o)}else{throw new h("Invalid mode. Only 'readonly'/'r' or 'readwrite'/'rw' are valid modes.")}u.dexieTrans=a;if(!y&&!b){C.push(u.pause())}var f=o.map(function(e){return a[e]});f.push(a);a.complete(r).error(function(e){var t=i(e);if(!t)T.on("error").fire(e)});try{n.apply(null,f)}catch(l){a.abort();i(l)}})};this.table=function(e){if(Object.keys(d).indexOf(e)==-1){throw new p("Table does not exist");return{AN_UNKNOWN_TABLE_NAME_WAS_SPECIFIED:1}}return new q(e,N)};O(F).from(i.Table).extend({get:function(e,t){var n=this;Q(function(){t(G(n._name))});return this._tf.createPromise(function(t,r){var i=n._tf.create(n._name).objectStore(n._name).get(e);i.onerror=ht(r,["getting",e,"from",n._name]);i.onsuccess=function(){var e=T[n._name]._mappedClass;if(e){var r=i.result;if(!r){t(r)}else if(k){r.__proto__=e.prototype;t(r)}else{var s=Object.create(e.prototype);for(var o in r)s[o]=r[o];t(s)}}else{t(i.result)}}}).then(t)},where:function(e){return new z(this._tf,this._name,e)},count:function(e){return(new W(new z(this._tf,this._name))).count(e)},limit:function(e){return(new this._collClass(new z(this._tf,this._name))).limit(e)},each:function(e){var t=this;Q(function(){e(G(t._name))});return this._tf.createPromise(function(n,r){var i=t._tf.create(t._name).objectStore(t._name).openCursor();i.onerror=ht(r,["calling","Table.each()","on",t._name]);Y(i,null,e,n,r,t._mappedClass&&t._mappedClass.prototype)})},toArray:function(e){var t=this;Q(function(){e([G(t._name)])});return this._tf.createPromise(function(e,n){var r=[];var i=t._tf.create(t._name).objectStore(t._name).openCursor();i.onerror=ht(n,["calling","Table.toArray()","on",t._name]);Y(i,null,function(e){r.push(e)},function(){e(r)},n,t._mappedClass&&t._mappedClass.prototype)}).then(e)},orderBy:function(e){return new this._collClass(new z(this._tf,this._name,e))}});O(I).from(F).extend({_wrop:function(e,t,n,r){var i=this,s=this._tf;return s.createPromise(function(o,u){var a=s.create(i._name,S);var f=a.objectStore(i._name);var l=f[e].apply(f,t||[]);l.onerror=ht(u,r);if(s.oneshot){a.oncomplete=function(){o(l.result)};if(n)l.onsuccess=n}else{if(n){l.onsuccess=function(){n.apply(this,arguments);o(l.result)}}else{l.onsuccess=function(){o(l.result)}}}})},put:function(e){return this._wrop("put",[e],function(t){var n=t.target.source.keyPath;if(n)ct(e,n,t.target.result)},["putting",e,"into",this._name])},add:function(e){return this._wrop("add",[e],function(t){var n=t.target.source.keyPath;if(n)ct(e,n,t.target.result)},["adding",e,"into",this._name])},"delete":function(e){return this._wrop("delete",[e],null,["deleting",e,"from",this._name])},clear:function(){return this._wrop("clear",[],null,["clearing",this._name])},where:function(e){return new z(this._tf,this._name,e,X)},modify:function(e){return(new X(new z(this._tf,this._name,null,X))).modify(e)}});(function(){function e(n){if(typeof n=="function"){return new n}else if(Array.isArray(n)){return[e(n[0])]}else if(typeof n=="object"){var r={};t(r,n);return r}else{return n}}function t(t,n){Object.keys(n).forEach(function(r){t[r]=e(n[r])})}O(q).from(I).extend({mapToClass:function(e,n){var r=this._mappedClass=e;this._instanceTemplate=Object.create(r.prototype);if(n){t(this._instanceTemplate,n)}return e},defineClass:function(e){var n={};t(n,e);var r=d[this._name].primKey.keyPath;this._mappedClass=function(){for(var e in n)if(e!=r)this[e]=n[e]};this._instanceTemplate=n;return this._mappedClass}})})();O(R).from(i.Transaction).extend({abort:function(){if(this._ctx.tf.trans&&!this._ctx.tf.inactive)try{this._ctx.tf.inactive=true;this._ctx.tf.trans.abort()}catch(e){}},table:function(e){if(Array.prototype.indexOf.call(this._ctx.storeNames,e)==-1)throw new p("Table does not exist");return new this._ctx.tableClass(e,this._ctx.tf)}});O(U).from(R);(function(){function e(e,t){try{throw t}catch(n){e._ctx.error=n}return e}function t(e){return Array.prototype.slice.call(Array.isArray(e[0])?e[0]:e,0).sort()}function n(e){return e==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function r(e){return e==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function s(e,t,n,r,i,s){var o=Math.min(e.length,r.length);var u=-1;for(var a=0;a<o;++a){var f=t[a];if(f!==r[a]){if(i(e[a],n[a])<0)return e.substr(0,a)+n[a]+n.substr(a+1);if(i(e[a],r[a])<0)return e.substr(0,a)+r[a]+n.substr(a+1);if(u>=0)return e.substr(0,u)+t[u]+n.substr(u+1);return null}if(i(e[a],f)<0)u=a}if(o<r.length&&s==="next")return e+n.substr(e.length);if(o<e.length&&s==="prev")return e.substr(0,n.length);return u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function o(e,t,i){function h(e){o=n(e);u=r(e);a=e==="next"?et:tt;f=o(i);l=u(i);c=e}var o,u,a,f,l,c;h("next");e._ondirectionchange=function(e){h(e)};e._addAlgorithm(function(e,n,r){var i=e.key;if(typeof i!=="string")return false;var o=u(i);if(t(o,l)){n(function(){e.continue()});return true}else{var h=s(i,o,f,l,a,c);if(h){n(function(){e.continue(h)})}else{n(r)}return false}})}O(z).from(i.WhereClause).extend({between:function(e,t,n,r){n=n!==false;r=r===true;if(e>t||e==t&&(n||r)&&!(n&&r))return(new W(this,a.only(e))).limit(0);return new this._ctx.collClass(this,a.bound(e,t,!n,!r))},equals:function(e){return new this._ctx.collClass(this,a.only(e))},above:function(e){return new this._ctx.collClass(this,a.lowerBound(e,true))},aboveOrEqual:function(e){return new this._ctx.collClass(this,a.lowerBound(e))},below:function(e){return new this._ctx.collClass(this,a.upperBound(e,true))},belowOrEqual:function(e){return new this._ctx.collClass(this,a.upperBound(e))},startsWith:function(t){if(typeof t!="string")return e(new W(this),new c("String expected"));return this.between(t,t+String.fromCharCode(65535),true,true)},startsWithIgnoreCase:function(t){if(typeof t!="string")return e(new W(this),new c("String expected"));if(t==="")return this.startsWith(t);var n=new this._ctx.collClass(this);o(n,function(e,t){return e.indexOf(t)===0},t);n._ondirectionchange=function(){e(n,new p("desc() not supported with WhereClause.startsWithIgnoreCase()"))};return n},equalsIgnoreCase:function(t){if(typeof t!="string")return e(new W(this),new c("String expected"));var n=new this._ctx.collClass(this);o(n,function(e,t){return e===t},t);return n},anyOf:function(e){var n=t(arguments);var r=new this._ctx.collClass(this);var i=et;r._ondirectionchange=function(e){i=e==="next"?et:tt;n.sort(i)};var s=0;r._addAlgorithm(function(e,t,r){var o=e.key;while(i(o,n[s])>0){++s;if(s===n.length){t(r);return false}}if(o===n[s]){t(function(){e.continue()});return true}else{t(function(){e.continue(n[s])});return false}});return r}})})();O(W).from(i.Collection).extend({_addFilter:function(e){var t=this._ctx;t.filter=at(t.filter,e)},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=at(t.algorithm,e)},_getIndexOrStore:function(e){var t=this._ctx;t.trans=t.tf.create(t.table,e||E);var n=t.trans.objectStore(t.table),r=t.index;return!r||n.keyPath&&r===n.keyPath?n:n.index(r)},_openCursor:function(e){var t=this._ctx;return this._getIndexOrStore(e)[t.op](t.range||null,t.dir+t.unique)},_promise:function(e,t){function r(e,t){ot(function(){t(n.error)})}var n=this._ctx;if(n.error){return n.tf.createPromise(r)}else{return n.tf.createPromise(e).then(t)}},_iterate:function(e,t,n,r){var i=this,s=this._ctx,o=T[s.table]._mappedClass;if(!s.or){Y(this._openCursor(r),at(s.algorithm,s.filter),e,t,n,o&&o.prototype)}else{(function(){function c(){if(++l===2)t()}function h(t,r,i){if(!u||u(r,i,c,n)){var s=JSON.stringify(lt(t,f));if(!a.hasOwnProperty(s)){a[s]=true;e(t,r,i)}}}var u=s.filter;var a={};var f=d[s.table].primKey.keyPath;var l=0;s.or._iterate(h,c,n,r);Y(i._openCursor(r),s.algorithm,h,c,n,o&&o.prototype)})()}},each:function(e){var t=this,n=this._ctx;Q(function(){e(G(n.table))});return this._promise(function(n,r){t._iterate(e,n,r)})},count:function(e){Q(function(){e(0)});var t=this,n=this._ctx;if(n.filter||n.algorithm||n.or){var r=0;return this._promise(function(e,n){t._iterate(function(){++r;return false},function(){e(r)},n)},e)}else{return this._promise(function(e,r){var i=t._getIndexOrStore();var s=n.range?i.count(n.range):i.count();s.onerror=ht(r,["calling","count()","on",t._name]);s.onsuccess=function(n){e(Math.min(n.target.result,Math.max(0,t._ctx.limit-t._ctx.offset)))}},e)}},sortBy:function(e,t){function o(e,t){if(t)return o(e[r[t]],t-1);return e[i]}function a(e,t){var n=o(e,s),r=o(t,s);return n<r?-u:n>r?u:0}var n=this._ctx;Q(function(){t([G(n.table)])});var r=e.split(".").reverse(),i=r[0],s=r.length-1;var u=this._ctx.dir==="next"?1:-1;return this.toArray(function(e){return e.sort(a)}).then(t)},toArray:function(e){var t=this,n=this._ctx;Q(function(){e([G(n.table)])});return this._promise(function(e,n){var r=[];t._iterate(function(e){r.push(e)},function(){e(r)},n)},e)},offset:function(e){var t=this._ctx;if(e<=0)return this;t.offset+=e;if(!t.or&&!t.algorithm&&!t.filter){this._addFilter(function(n,r,i){if(e===0)return true;if(e===1){--e;return false}r(function(){n.advance(e);e=0});return false})}else{this._addFilter(function(n,r,i){return--e<0})}return this},limit:function(e){this._ctx.limit=Math.min(this._ctx.limit,e);this._addFilter(function(t,n,r){if(--e<=0)n(r);return e>=0});return this},first:function(e){var t=this;Q(function(){e(G(t._ctx.table))});return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.desc().first(e)},and:function(e){var t=this;Q(function(){e(G(t._ctx.table))});this._addFilter(function(t){return e(t.value)});return this},or:function(e){return new z(this._ctx.tf,this._ctx.table,e,this.constructor,this)},desc:function(){this._ctx.dir=this._ctx.dir=="prev"?"next":"prev";if(this._ondirectionchange)this._ondirectionchange(this._ctx.dir);return this},eachKey:function(e){var t=this;Q(function(){e(G(t._ctx.table)[t._ctx.index])});this._ctx.op="openKeyCursor";return this.each(function(t,n){e(n.key)})},eachUniqueKey:function(e){this._ctx.unique="unique";return this.eachKey(e)},keys:function(e){Q(function(){e([G(n.table)[t._ctx.index]])});var t=this,n=this._ctx;this._ctx.op="openKeyCursor";var r=[];return this.each(function(e,t){r.push(t.key)}).then(function(){return r}).then(e)},uniqueKeys:function(e){this._ctx.unique="unique";return this.keys(e)},distinct:function(){var e={};this._addFilter(function(t){var n=JSON.stringify(t.primaryKey);var r=e.hasOwnProperty(n);e[n]=true;return!r});return this}});O(X).from(W).extend({modify:function(e){var t=this,n=this._ctx;return this._promise(function(r,i){function a(e,t,r){++u;for(var a=0,f=s.length;a<f;++a){e[s[a]]=o[a](e)}var l=t.update(e);l.onerror=ht(function(e){r(function(){});var t=i(e);if(t&&n.oneshot)n.tf.resume();return t},function(){return["modifying",e,"on",n.table]})}if(!n.oneshot)n.tf.pause();var s=Object.keys(e);var o=s.map(function(t){var n=e[t];return n instanceof Function?n:function(){return n}});var u=0;if(n.oneshot){t._iterate(a,function(){},i,S);n.trans.oncomplete=function(){r(u)}}else{t._iterate(a,function(){n.tf.resume();r(u)},i,S)}})},"delete":function(){var e=this,t=this._ctx;return this._promise(function(n,r){function s(e,n,s){++i;n.delete().onerror=ht(function(e){s(function(){});var n=r(e);if(n&&t.oneshot)t.tf.resume();return n},function(){return["deleting",e,"on",t.table]})}if(!t.oneshot)t.tf.pause();var i=0;if(t.oneshot){e._iterate(s,function(){},r,S);t.trans.oncomplete=function(){n(i)}}else{e._iterate(s,function(){t.tf.resume();n(i)},r,S)}})}});A(nt.prototype,{create:function(e,t){if(!y)throw b;return y.transaction(e,t||E)},oneshot:true,createPromise:function(e){return new s(e)},pause:function(){this.paused=true;this.createPromise=function(e){var t=this.constructor.prototype;var n=this;var r=function(t,r){var i=this,s=arguments;n.waitingFns.push(function(){try{e.apply(i,s)}catch(t){r(t)}})};return t.createPromise.call(this,r)};return this},resume:function(){this.paused=false;delete this.createPromise;while(this.waitingFns.length>0&&!this.paused){var e=this.waitingFns.shift();try{e()}catch(t){}}return this}});O(rt).from(nt).extend({oneshot:false,create:function(){if(this.trans)return this.trans;if(!y)throw b;var e=this;this.trans=y.transaction(this.storeNames,this.mode);this.trans.onerror=function(t){e.dexieTrans.on("error").fire(t&&t.target.error);t.preventDefault();e.dexieTrans.abort()};this.trans.onabort=this.dexieTrans.on("abort").fire;this.trans.oncomplete=this.dexieTrans.on("complete").fire;this.dexieTrans.on("abort",function(){e.inactive=true});this.dexieTrans.on("complete",function(){e.inactive=true});return this.trans},createPromise:function(e){var t=this;var n=nt;var r=n.prototype.createPromise.call(this,e);r.onuncatched=function(e){t.dexieTrans.on("error").fire(e);t.dexieTrans.abort()};return r}});O(it).from(rt).extend({createPromise:function(e){function n(e){return function(){e.apply(this,arguments);if(--t.uncompleteRequests==0&&t.onfinish)t.onfinish()}}var t=this;++t.uncompleteRequests;var r=rt;return r.prototype.createPromise.call(this,function(t,r){arguments[0]=n(t);arguments[1]=n(r);e.apply(this,arguments)})}});this._types={Collection:W,Promise:s,Table:F,Transaction:R,Version:M,WhereClause:z,WriteableCollection:X,WriteableTable:I,WriteableTransaction:U};L()}var s=function(){function t(t){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof t!=="function")throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];this._catched=false;var n=this;var r=true;try{a(t,function(t){if(r)e(i,n,t);else i(n,t)},function(t){if(r){e(s,n,t);return false}else{return s(n,t)}})}finally{r=false}}function n(e){var t=this;if(this._state===null){this._deferreds.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null){(t._state?e.resolve:e.reject)(t._value);return}var i;try{i=n(t._value);if(!t._state)r(t)}catch(s){var o=e.reject(s);if(!o&&t.onuncatched){try{t.onuncatched(s)}catch(s){}}return}e.resolve(i)}function r(e){e._catched=true;if(e._parent)r(e._parent)}function i(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&(typeof t==="object"||typeof t==="function")){if(typeof t.then==="function"){a(function(e,n){t.then(e,n)},function(t){i(e,t)},function(t){s(e,t)});return}}e._state=true;e._value=t;o.call(e)}catch(n){s(n)}}function s(e,t){e._state=false;e._value=t;o.call(e);if(!e._catched&&e.onuncatched){try{e.onuncatched(e._value)}catch(n){}}return e._catched}function o(){for(var e=0,t=this._deferreds.length;e<t;e++){n.call(this,this._deferreds[e])}this._deferreds=null}function u(e,t,n,r){this.onFulfilled=typeof e==="function"?e:null;this.onRejected=typeof t==="function"?t:null;this.resolve=n;this.reject=r}function a(e,t,n){var r=false;try{e(function(n){if(r)return;r=true;t(n)},function(t){if(r)return;r=true;return n(t)})}catch(i){if(r)return;return n(i)}}var e=typeof setImmediate==="undefined"?function(e,t,n,r){var i=arguments;setTimeout(function(){e.apply(this,[].slice.call(i,1))},0)}:function(e,t,n,r){setImmediate.apply(this,arguments)};t.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&Array.isArray(arguments[0])?arguments[0]:arguments);return new t(function(t,n){function i(s,o){try{if(o&&(typeof o==="object"||typeof o==="function")){var u=o.then;if(typeof u==="function"){u.call(o,function(e){i(s,e)},n);return}}e[s]=o;if(--r===0){t(e)}}catch(a){n(a)}}if(e.length===0)return t([]);var r=e.length;for(var s=0;s<e.length;s++){i(s,e[s])}})};t.prototype.then=function(e,r){var i=this;var s=new t(function(t,s){n.call(i,new u(e,r,t,s))});s._parent=this;return s};t.prototype["catch"]=function(e){if(arguments.length===1)return this.then(null,e);var t=arguments[0],n=arguments[1];return this.then(null,function(e){if(e instanceof t)return n(e);else throw e})};t.prototype["finally"]=function(e){return this.then(e,e)};t.prototype.onuncatched=null;t.resolve=function(e){return new t(function(t){t(e)})};t.reject=function(e){return new t(function(t,n){n(e)})};t.race=function(e){return new t(function(t,n){e.map(function(e){e.then(t,n)})})};return t}();i.delete=function(e){var t=new i(e),n=t.delete();n.onblocked=function(e){t.on("blocked",e);return this};return n};i.Collection=function(){};i.Table=function(){};i.Transaction=function(){};i.WhereClause=function(){};i.dependencies={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange,IDBTransaction:e.IDBTransaction||e.webkitIDBTransaction,Promise:e.Promise,Error:e.Error||String,TypeError:e.TypeError||String,RangeError:e.RangeError||String,DOMError:e.DOMError||String};i.version=.93;t("Dexie",i)}).apply(this,typeof module==="undefined"||typeof window!=="undefined"&&this==window?[window,function(e,t){window[e]=t},true]:[global,function(e,t){module.exports=t},false])